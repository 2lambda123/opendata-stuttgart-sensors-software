source("installrequire.R")
installrequire(c("xlsx","lubridate","dplyr","ggplot2"))
# library(xlsx)
# library(lubridate)
# library(dplyr)
# library(ggplot2)


###########################################################################
#####Preparation(only once)################################################
###########################################################################
#roh <- read.xlsx(file="table23032015135021029.xlsx", sheetIndex=1)
#names(roh) <- c("Messstelle", "Datetime", "Agg_Zeitraum", "Agg_Art", "NO2")
#roh$NO2 <- as.numeric(as.character(roh$NO2))
#roh$Datetime <- ymd_hm(roh$Datetime)
#roh <- roh %>% mutate(Woche=week(Datetime)) %>% mutate(Monat=month(Datetime)) %>% mutate(Date=as.Date(Datetime))

#load(".RData")

#Daten von Andreas laden
# get data from 
# https://paste.madflex.de/d9rcQxUT#particlesdata.csv
test <- read.csv("data/particlesdata.csv",dec=".", sep=",", na.strings=c("","NA"))
#ppd <- filter(test, type=="PPD42NS")
# 
# #Timestamps formatieren
# pattern <- "[0-9]+-[0-9]+-[0-9]+ [0-9][0-9]:[0-9][0-9]:[0-9][0-9]"
# test <- test %>% 
#     mutate(timestamp2 = regexpr(pattern, timestamp)) %>% 
#     mutate(timestamp2 = regmatches(timestamp, timestamp2)) %>% 
#     mutate(timestamp2=ymd_hms(timestamp2))
test$timestamp2<-as.POSIXct(strptime(test$timestamp,format="%Y-%m-%d %H:%M:%S"))
# test$timestamp2<-strptime(test$timestamp,format="%d.%m.%y %H:%M:%S+%Z")

# str(test)
# 'data.frame':   319836 obs. of  27 variables:                                                                                                               
#  $ timestamp        : Factor w/ 319831 levels "2015-04-05 23:13:10.759068+00:00",..: 319822 319805 319788 319771 319754 319737 319720 319703 319686 319669 ...                                                                                                                                                          
# sensor type
#  $ type             : Factor w/ 3 levels "dsm501a","GP2Y1010AU0F",..: 1 1 1 1 1 1 1 1 1 1 ...                                                               
#  $ indoor           : Factor w/ 2 levels "False","True": 2 2 2 2 2 2 2 2 2 2 ...                                                                            
#  $ location_id      : int  4 4 4 4 4 4 4 4 4 4 ...                                                                                                          
#  $ sampling_rate    : int  15000 15000 15000 15000 15000 15000 15000 15000 15000 15000 ...                                                                  
# 
#  $ P1               : Factor w/ 61894 levels "","017.95","05.06",..: 1 1 1 1 1 1 1 1 1 1 ...                                                                
#  $ P2               : num  NA NA NA NA NA NA NA NA NA NA ...                                                                                                
#  $ durP1            : num  NA NA NA NA NA NA NA NA NA NA ...                                                                                                
#  $ durP2            : int  NA NA NA NA NA NA NA NA NA NA ...                                                                                                
#  $ ratioP1          : num  NA NA NA NA NA NA NA NA NA NA ...                                                                                                
#  $ ratioP2          : num  NA NA NA NA NA NA NA NA NA NA ...                                                                                                
#  $ temperature      : logi  NA NA NA NA NA NA ...                                                                                                           
#  $ humidity         : logi  NA NA NA NA NA NA ...                                                                                                           
#  $ pressure         : logi  NA NA NA NA NA NA ...
#  $ altitude         : logi  NA NA NA NA NA NA ...
#  $ pressure_sealevel: logi  NA NA NA NA NA NA ...
#  $ brightness       : logi  NA NA NA NA NA NA ...
#  $ dust_density     : Factor w/ 77 levels "","-.00",".00",..: 1 1 1 1 1 1 1 1 1 1 ...
#  $ vo_raw           : num  NA NA NA NA NA NA NA NA NA NA ...
#  $ voltage          : num  NA NA NA NA NA NA NA NA NA NA ...
#  $ P10              : num  16656 28523 15669 12731 14018 ...
#  $ P25              : num  3514 4474 3570 3104 3552 ...
#  $ durP10           : int  2906824 3794072 2812860 2503032 2644788 2711264 2342328 2416972 2560024 2548652 ...
#  $ durP25           : int  972924 1198488 986724 870160 982288 969476 902680 850496 924380 968796 ...
#  $ ratioP10         : num  19.4 25.3 18.8 16.7 17.6 ...
#  $ ratioP25         : num  6.49 7.99 6.58 5.8 6.55 6.46 6.02 5.67 6.16 6.46 ...
#  $ timestamp2       : POSIXct, format: "2015-05-05 08:15:59" "2015-05-05 08:15:44" ...



#Werte fuer PM2.5 im Zeitverlauf
p1 <- ggplot(filter(test, type=="PPD42NS"), aes(timestamp2, P2, color=type)) + geom_point() + theme(axis.text.x = element_text(angle=90)) + geom_point(data=filter(test, type == "GP2Y1010AU0F"), aes(timestamp2, P25, color=type)) + scale_
#+ geom_point(data=filter(test, type=="GP2Y1010AU0F"), aes(timestamp2, vo_raw, color=type)) 

##random sample for histogram
#rand.ppd <- sample_n(ppd, 1000)
#p2 <- ggplot(data=filter(test, type=="PPD42NS"), aes(P2)) + geom_histogram(binwidth=1/10)

##Daten fuer Sensoren anschauen
#head(test)
#sample_n(filter(test, type=="PPD42NS"), 10)
#sample_n(filter(test, type=="GP2Y1010AU0F"), 10)

